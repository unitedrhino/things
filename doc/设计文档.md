# 物联网设备管理平台设计文档
## 前言
这个物联网设备管理平台需要做到支持多个设备,多种设备,良好的拓展性.目前以宠物定位项目为核心,物联网设备为拓展的思路进行开发,能够做到新增更多种类的设备可以很少改动的进行适应新的需求.
## 架构设计
![avatar](./assets/架构图.jpg)
### MQTT服务器
MQTT服务器负责提供mqtt服务  
目前使用开源的mqtt服务器hmq提供mqtt,mqtts给client进行连接  
如果有合适的mqtt服务器也可以切换
改造点:
* 需要支持我们的特殊的权限控制,支持grpc鉴权及传递的信息需要增加账号,密码,clientID,tls秘钥,ip地址进行认证
* mqtts尚有问题
### 设权中心
设备权限管理中心负责提供:  
* MQTT服务器的设备权限控制
  * 设备登录认证及记录
  * 限制设备只能访问到设备可以访问到的topic
* 设备的初次入网注册身份认证
  * 将设备加入到数据库并分配账号密码

### 设交中心
设备交互中心负责和设备进行交互
* 收集设备发送来的数据并保存到数据库中(如设备的定位信息)
* 转发处理用户对设备的请求(如远程鸣叫)
* 设备升级提供升级包(通过mqtt返回升级包的地址,设备通过http网关到对应的http地址下载升级包)

### 数据中心
数据中心负责和前端交互提供处理处理服务
* 历史轨迹
* 电子围栏的设置及提醒
* 实时位置的返回
* 设备绑定与设置(设备的名字,头像等)
### 用管中心
负责用户的登录支付设置
* 用户登录(账密,微信,短信)
* 用户支付管理